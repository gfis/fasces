#!make

# Generate OEIS Sequence A055187 and its companions
# as defined by Clark Kimberling
# http://faculty.evansville.edu/ck6/integer/unsolved.html, Problem 4
# @(#) $Id$
# 2018-04-20, Georg Fischer
# 
# c.f. listing.tmp (produced by target "listing", below)
#---------------------------------
TARGET=cumulcount
LIMIT=2000

all: 05518n 2177nn
#----------
0307_list:
	grep -aE "^A0307" ../names
#----------
0551_list:
	grep -aE "^A0551" ../names
05518n: 055186 055187 055188 055189 055190 055191
055186:
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=$(LIMIT) OPER=io A1=0
055187:
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=$(LIMIT) OPER=io A1=1
055188:
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=$(LIMIT) OPER=fa A1=2
055189:
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=$(LIMIT) OPER=io A1=3
055190:
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=$(LIMIT) OPER=io A1=4
055191:
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=$(LIMIT) OPER=io A1=5
#----------
2177_list:
	grep -aE "^A2177" ../names
2177nn: 217760 217780 #	ok
217760: # c.f. 055186
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=10000    OPER=fa A1=0
217780: # c.f. 055187
	make $(TARGET) RULE=A S=1 NOEIS=$@ LEN=10000    OPER=fa A1=1
#---------------------------------------------------------------
cumulcount:
	# -------------------------------------------------------
	echo perl $(TARGET).pl $(RULE) $(S) $(NOEIS) $(LEN) $(OPER) $(A1) $(D1)
	test -s b$(NOEIS).txt || wget http://oeis.org/A$(NOEIS)/b$(NOEIS).txt
	perl $(TARGET).pl $(RULE) $(S) $(NOEIS) $(LEN) $(OPER) $(A1) $(D1) > A$(NOEIS).pn.tmp
	grep -Ev "^ *#" b$(NOEIS).txt | head -n $(LIMIT) > bf.tmp 
	grep -Ev "^ *#" A$(NOEIS).pn.tmp | head -n `wc -l bf.tmp | cut -d " " -f 1` > pn.tmp
#	diff -w -y                         --width=32  bf.tmp pn.tmp || :
	diff -w -y --suppress-common-lines --width=32  bf.tmp pn.tmp || :
#--------
wgetall:
	wget http://oeis.org/A131388/b131388.txt
	wget http://oeis.org/A131389/b131389.txt
	wget http://oeis.org/A131393/b131393.txt
	wget http://oeis.org/A131394/b131394.txt
#-------------------------------------------
# get the list of relevant sequence numbers
nplists: Anoeis npname npseqs
Anoeis:
	grep -E "^[0-9]" makefile | sed -e "s/^/A/" \
	| cut -b 1-7 | sort | uniq | tee $@.tmp
	wc $@.tmp
#----
# prepare the descriptions
npname: Anoeis
	grep -f Anoeis.tmp ../names    | sort \
	| sed -e "s/generated by/ /" -e "s/(in Comments) with//" \
	 -e "s/Sequence//i" \
	 -e "s/Conjectured permutation of the //" \
	 -e "s/conjectured permutation//" \
	| cut -b 1-80 \
	| tee $@.tmp
	wc $@.tmp
#----
# compare the sequence lists to the b-files
npseqs: Anoeis wgetrest
	grep -f $@.tmp ../stripped | sort | tee npseqs.tmp
	perl npseqs.pl < npseqs.tmp
#----
wgetrest: Anoeis
	cut -b 2-7 Anoeis.tmp > noeis.tmp
	cat noeis.tmp | xargs -l -i{} make wget1 NOEIS={}
wget1:
	test -s b$(NOEIS).txt || wget http://oeis.org/A$(NOEIS)/b$(NOEIS).txt
#----
listing:
	make -s all TARGET=list1 | sort \
	| sed -e "s/ ak / a  /" -e "s/ dk / d  /"\
	| tee listing.tmp
	wc listing.tmp
list1: 
	echo [https://oeis.org/A$(NOEIS) A$(NOEIS)]   Rule $(RULE).$(S)   $(OPER)   $(A1) $(D1)
#----
# e.g. https://oeis.org/search?q=id:A257908&fmt=text
internal: Anoeis
	cat Anoeis.tmp | xargs -l -i{} make intern1 ANOEIS={}
intern1:
	test -s $(ANOEIS).int || \
	wget -O $(ANOEIS).int "http://oeis.org/search?q=id:$(ANOEIS)\&fmt=text" 
